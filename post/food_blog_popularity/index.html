<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Tom Beer">

  
  
  
    
  
  <meta name="description" content="For my favorite food blog">

  
  <link rel="alternate" hreflang="en-us" href="https://tom-beer.github.io/post/food_blog_popularity/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_huce93ec8a6fd7e12c2beec32639fe78a0_7050_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_huce93ec8a6fd7e12c2beec32639fe78a0_7050_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://tom-beer.github.io/post/food_blog_popularity/">

  
  
  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@aTomBeer">
  <meta property="twitter:creator" content="@aTomBeer">
  
  <meta property="og:site_name" content="Tom Beer">
  <meta property="og:url" content="https://tom-beer.github.io/post/food_blog_popularity/">
  <meta property="og:title" content="Predicting recipe popularity | Tom Beer">
  <meta property="og:description" content="For my favorite food blog"><meta property="og:image" content="https://tom-beer.github.io/post/food_blog_popularity/featured.png">
  <meta property="twitter:image" content="https://tom-beer.github.io/post/food_blog_popularity/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2022-10-31T03:07:42&#43;03:00">
    
    <meta property="article:modified_time" content="2022-10-31T03:07:42&#43;03:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tom-beer.github.io/post/food_blog_popularity/"
  },
  "headline": "Predicting recipe popularity",
  
  "image": [
    "https://tom-beer.github.io/post/food_blog_popularity/featured.png"
  ],
  
  "datePublished": "2022-10-31T03:07:42+03:00",
  "dateModified": "2022-10-31T03:07:42+03:00",
  
  "author": {
    "@type": "Person",
    "name": "Tom Beer"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Tom Beer",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tom-beer.github.io/images/icon_huce93ec8a6fd7e12c2beec32639fe78a0_7050_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "For my favorite food blog"
}
</script>

  

  


  


  





  <title>Predicting recipe popularity | Tom Beer</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Tom Beer</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Tom Beer</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Predicting recipe popularity</h1>

  
  <p class="page-subtitle">Having fun scraping, embedding and regressing</p>
  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Oct 31, 2022
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    3 min read
  </span>
  

  
  
  

  
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <h3 id="my-favorite-food-blog">My favorite food blog</h3>
<p>I&rsquo;m an avid reader of a multitude of food blogs.
While I wish I read books, I just can&rsquo;t prioritize it high enough, and apart from professional material, the only reading I do is food blogs.
I love 
<a href="https://www.davidlebovitz.com/" target="_blank" rel="noopener">David Lebovitz</a> for the french drinks and ap√©ros, and 
<a href="https://greenkitchenstories.com/" target="_blank" rel="noopener">Green Kitchen Stories</a> for healthy, kid friendly (Yaar loves 
<a href="https://greenkitchenstories.com/apple-almond-buckwheat-muffins/" target="_blank" rel="noopener">these muffins</a>) recipes.
In Hebrew, I check 
<a href="https://www.ptitim.com/" target="_blank" rel="noopener">Ptitim</a>, 
<a href="https://www.limortiroche.com/" target="_blank" rel="noopener">Limor Tiroche</a> and 
<a href="https://www.michalwaxman.com/" target="_blank" rel="noopener">Michal Waxman</a> on a weekly basis and read every word in every post.</p>
<p>But above all these, my favorite food blog is 
<a href="https://smittenkitchen.com/" target="_blank" rel="noopener">Smitten Kitchen</a>.
My metric here (we&rsquo;re in a quantitative field after all) is the total number of recipes made.
This proxy may be skewed by ultra-recurrent recipes
(like the 
<a href="https://smittenkitchen.com/2010/05/oatmeal-pancakes/" target="_blank" rel="noopener">oatmeal pancakes</a> I make every Saturday morning for the last ~18 months),
but it&rsquo;s still a useful metric.</p>
<p>Having wanted to play around with web scraping and parsing,
I thought it would be a fun weekend project to build a popularity prediction model for Smitten Kitchen recipes.</p>
<hr>
<h3 id="dataset">Dataset</h3>
<p>Beautiful Soup helped with basic parsing,
on top of which specific features like the publish date, categories, post title, introduction and the recipe itself were extracted.
The number of comments was defined as the measure of recipe popularity (more on this decision in the last section).<br>
The resulting dataset (not showing the category column) has 505 recipes and looks like this:
<img src="df2.png"></p>
<p>As can be expected, the number of comments is heavy tailed.
But this tail is rather fat - the standard deviation is almost as large as the median:
<img src="n_comments_hist.png"></p>
<hr>
<h3 id="setting-the-baseline">Setting the baseline</h3>
<p>RMSE on the test set (~100 recipes) was chosen as the evaluation criteria for all models.</p>
<p>A useful baseline for regression tasks is simply to predict the target&rsquo;s mean.
This yields an RMSE of <strong>202</strong>, a bit higher than the target&rsquo;s STD (due to train/test sample variability).</p>
<p>It couldn&rsquo;t be hard to beat this error, right? Let&rsquo;s see..</p>
<hr>
<h3 id="recipe-categories">Recipe Categories</h3>
<p>Each recipe has a few categories (tags) - an average of 5 per blog entry.
The most prevalent are <em>vegetarian, summer, breakfast, cake, salad</em> and <em>weeknight favorite</em>.
The 184 categories were encoded as bits and passed to a CatBoost model with default parameters.
The RMSE decreased to <strong>194</strong> - quite underwhelming.</p>
<hr>
<h3 id="the-direction-of-time">The Direction of Time</h3>
<p>Time is a significant predictor of popularity, especially in the early days of the site.</p>
<img src="time.png">
<p>Using the annual means from the train set as an estimator for recipe popularity yields an
RMSE of <strong>181</strong> - now we&rsquo;re getting somewhere!</p>
<hr>
<h3 id="incorporating-free-text">Incorporating free text</h3>
<p>The dataset includes three fields of free text: post title, an introduction and the recipe itself.</p>
<p>
<a href="https://www.sbert.net/" target="_blank" rel="noopener">Sentence Transformers</a> provides a convenient API for encoding chunks of text,
but they don&rsquo;t play nicely with scikit-learn pipelines. Recently I came across a compact library called

<a href="https://github.com/koaning/embetter" target="_blank" rel="noopener"><em>Embetter</em></a> which does just that - a scikit-learn compatible interface
for sentence transformers.
It also has an interface over 
<a href="https://github.com/rwightman/pytorch-image-models" target="_blank" rel="noopener">timm</a> for image use cases.
With Embetter, predicting a target from text is as easy as:</p>
<pre><code class="language-python">pipe = make_pipeline(ColumnGrabber(&quot;title&quot;), SentenceEncoder('all-MiniLM-L6-v2'), RandomForestRegressor())
pipe.fit(df_train, df_train.n_comments)
mean_squared_error(df_val.n_comments, pipe.predict(df_val), squared=False)
</code></pre>
<p>After some experiments, I settled on the following pipeline:</p>
<img src="pipe.png" width=600 height=600>
<p>Embedding the other text fields did not add predictive power.
Applying PCA and using other regressors just made things worse.
The RMSE for this setup was <strong>174</strong> - only slightly better than using the year alone. Meh.</p>
<hr>
<h3 id="closing-thoughts">Closing thoughts</h3>
<p>While this was a lot of fun, I can&rsquo;t help but feel a bit disappointed in failing to predict recipe popularity.
The thing is, I equated popularity with the number of comments.
But it&rsquo;s a mere proxy for popularity. And as we&rsquo;ve seen in a

<a href="https://tom-beer.github.io/post/proxies_ml/" target="_blank" rel="noopener">previous post</a>,
this has implications for the feasibility and usability of the models built upon it.</p>
<hr>
<h3 id="takeaways">Takeaways</h3>
<p>
<a href="https://smittenkitchen.com/2019/06/chocolate-budino/" target="_blank" rel="noopener">This is a fabulous dessert</a>. Go make it.</p>
<p><img src="img.png" alt="img.png"></p>

    </div>

    



















  
  





  
    
    
    
      
    
    
    
    <div class="media author-card content-widget-hr">
      
        
        <img class="avatar mr-3 avatar-circle" src="/author/tom-beer/avatar_hu9034ec2da80e6325848318956e058d92_564834_270x270_fill_q90_lanczos_center.jpg" alt="Tom Beer">
      

      <div class="media-body">
        <h5 class="card-title"><a href="https://tom-beer.github.io/">Tom Beer</a></h5>
        
        
        <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:tom.beer@khealth.ai" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/aTomBeer" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/tom-beer/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/tom-beer" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://huggingface.co/tom-beer" target="_blank" rel="noopener">
        <i class="fab fa-face-smiling-hands"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=6wZ70dEAAAAJ&amp;hl=en" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
</ul>

      </div>
    </div>
  
















  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    

    
    

    

    
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
    
    
    
    <script src="/js/academic.min.6f7ce8be710290b8c431bbc97f405d15.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
